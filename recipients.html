<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Recipients - BDI</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"><link href="style.css" rel="stylesheet"></head><body class="bg-light">
<nav class="navbar navbar-white bg-white shadow-sm"><div class="container"><a class="navbar-brand text-danger fw-bold" href="index.html">BDI</a></div></nav>
<main class="container my-4">
<div class="row g-3">
  <div class="col-12 col-md-5">
    <div class="card p-3">
      <h5>Request Blood</h5>
      <div class="mb-2"><input id="r_name" placeholder="Patient / Requester name" class="form-control"/></div>
      <div class="mb-2"><select id="r_blood" class="form-select"><option value="">Select blood group</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>O+</option><option>O-</option><option>AB+</option><option>AB-</option></select></div>
      <div class="mb-2"><input id="r_units" type="number" value="1" min="1" class="form-control"/></div>
      <div class="mb-2"><input id="r_phone" placeholder="Contact phone" class="form-control"/></div>
      <div class="mb-2"><input id="r_city" placeholder="City" class="form-control"/></div>
      <div class="mb-2"><textarea id="r_notes" class="form-control" placeholder="Notes (hospital, urgency, etc)"></textarea></div>
      <div class="d-flex gap-2"><select id="fulfill_bank" class="form-select w-50"><option value="">Fulfill from bank (optional)</option></select><button id="r_add" class="btn btn-danger"><i class="fa-solid fa-plus me-2"></i>Submit Request</button></div>
      <div id="r_status" class="small text-muted mt-2"></div>
    </div>
  </div>
  <div class="col-12 col-md-7">
    <div class="card p-3">
      <h5>Search & Manage Requests</h5>
      <div class="d-flex gap-2 mb-2"><input id="q" class="form-control" placeholder="Search by blood group or city"/><button id="q_btn" class="btn btn-outline-secondary">Search</button><button id="q_all" class="btn btn-outline-danger">Show All</button></div>
      <div id="requestList">No requests yet.</div>
    </div>
  </div>
</div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script src="app.js"></script>
<script>
(function(){
  const b = window.bdi;
  function refreshBanks(){ const sel = document.getElementById('fulfill_bank'); sel.innerHTML = '<option value="">Fulfill from bank (optional)</option>'; (b.getBanks()||[]).forEach(bank=>{ const opt=document.createElement('option'); opt.value=bank.id; opt.textContent = bank.name + ' â€” ' + (bank.city||''); sel.appendChild(opt); }); }
  document.getElementById('r_add').addEventListener('click', ()=>{
    const req = { name: document.getElementById('r_name').value.trim(), bloodGroup: document.getElementById('r_blood').value.trim(), units: parseInt(document.getElementById('r_units').value,10)||1, phone: document.getElementById('r_phone').value.trim(), city: document.getElementById('r_city').value.trim(), notes: document.getElementById('r_notes').value.trim(), status: 'open' };
    const bankToUse = document.getElementById('fulfill_bank').value;
    if(bankToUse){ const res = b.fulfillRequestFromBank(bankToUse, req.bloodGroup, req.units); if(!res.ok){ document.getElementById('r_status').textContent = res.msg; window.showToast(res.msg,true); return; } window.showToast(res.msg); }
    const res = b.addRequest(req); document.getElementById('r_status').textContent = res.msg; if(res.ok){ document.getElementById('r_name').value=''; document.getElementById('r_phone').value=''; document.getElementById('r_city').value=''; document.getElementById('r_notes').value=''; document.getElementById('r_units').value='1'; }
    b.renderAll();
  });
  document.getElementById('q_btn').addEventListener('click', ()=>{ b.renderRequests(document.getElementById('q').value.trim()); });
  document.getElementById('q_all').addEventListener('click', ()=>{ document.getElementById('q').value=''; b.renderRequests(); });
  window.addEventListener('load', ()=>{ refreshBanks(); b.renderRequests(); });
})();
</script>
</body></html>
