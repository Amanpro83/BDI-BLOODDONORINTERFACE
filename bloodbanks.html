<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Blood Banks - BDI</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"><link href="style.css" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script></head><body class="bg-light">
<nav class="navbar navbar-white bg-white shadow-sm"><div class="container"><a class="navbar-brand text-danger fw-bold" href="index.html">BDI</a></div></nav>
<main class="container my-4">
<div class="row g-3">
  <div class="col-12 col-md-6">
    <div class="card p-3">
      <h5>Add / Manage Banks</h5>
      <div class="mb-2"><input id="b_name" placeholder="Bank name (e.g. City Blood Bank)" class="form-control"/></div>
      <div class="mb-2"><input id="b_city" placeholder="City" class="form-control"/></div>
      <div><button id="b_add" class="btn btn-danger"><i class="fa-solid fa-building-circle-plus me-2"></i>Create Bank</button></div>
      <div id="b_status" class="small text-muted mt-2"></div>
      <div class="mt-3" id="banksList">No banks yet.</div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card p-3">
      <h5>Selected Bank Inventory</h5>
      <div class="d-flex gap-2 mb-2"><select id="selectBank" class="form-select"><option value="">Select a bank to edit</option></select><button id="loadBank" class="btn btn-outline-secondary">Load</button><button id="bankAudit" class="btn btn-outline-danger">Audit Log</button></div>
      <div id="inventoryGrid" class="grid-inventory" aria-live="polite"></div>
      <div class="mt-2"><button id="saveInv" class="btn btn-danger">Save Inventory</button></div>
      <div id="inv_status" class="small text-muted mt-2"></div>
    </div>
    <div class="card p-3 mt-3">
      <h6>Inventory Chart — Selected Bank</h6>
      <canvas id="bankChart"></canvas>
      <pre id="auditLog" class="small text-muted mt-2"></pre>
    </div>
  </div>
</div>
</main>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script src="app.js"></script>
<script>(function(){const b = window.bdi;function refreshBankSelector(){ const sel=document.getElementById('selectBank'); sel.innerHTML='<option value="">Select a bank to edit</option>'; (b.getBanks()||[]).forEach(bank=>{ const opt=document.createElement('option'); opt.value=bank.id; opt.textContent = bank.name + ' — ' + (bank.city||''); sel.appendChild(opt); }); } document.getElementById('b_add').addEventListener('click', ()=>{ const name=document.getElementById('b_name').value.trim(); const city=document.getElementById('b_city').value.trim(); const res = b.addBank({name,city}); document.getElementById('b_status').textContent = res.msg; if(res.ok){ document.getElementById('b_name').value=''; document.getElementById('b_city').value=''; } refreshBankSelector(); b.renderAll(); window.showToast(res.msg); }); document.getElementById('loadBank').addEventListener('click', ()=>{ const id = document.getElementById('selectBank').value; if(!id){ alert('Select bank'); return; } const bank = b.getBanks().find(bb=>bb.id===id); if(!bank) return; const grid = document.getElementById('inventoryGrid'); grid.innerHTML=''; const groups = ['A+','A-','B+','B-','O+','O-','AB+','AB-']; groups.forEach(g=>{ const val = (bank.inventory && bank.inventory[g])? bank.inventory[g] : 0; const wrap = document.createElement('div'); wrap.className='inv-row mb-2'; wrap.innerHTML = `<label class="inv-label w-100">${g} <input class="inv-input form-control" data-group="${g}" value="${val}" type="number" min="0"></label>`; grid.appendChild(wrap); }); document.getElementById('inv_status').textContent = 'Loaded bank: ' + bank.name; document.getElementById('saveInv').setAttribute('data-bank', id); b.renderAll(); }); document.getElementById('saveInv').addEventListener('click', ()=>{ const bankId = document.getElementById('saveInv').getAttribute('data-bank'); if(!bankId){ alert('Load a bank first to save'); return; } const inputs = document.querySelectorAll('.inv-input'); let inv = {}; inputs.forEach(inp=>{ const g = inp.getAttribute('data-group'); inv[g] = Math.max(0, parseInt(inp.value,10)||0); }); b.updateBankInventory(bankId, inv); document.getElementById('inv_status').textContent = 'Saved inventory.'; b.toast('Inventory saved'); b.renderAll(); window.showToast('Inventory saved'); }); document.getElementById('bankAudit').addEventListener('click', ()=>{ const id=document.getElementById('selectBank').value; if(!id){ alert('Select bank'); return; } const logs = b.getAuditLog(id); document.getElementById('auditLog').textContent = logs.length? logs.map(l=>new Date(l.ts).toLocaleString()+': '+l.action+' '+l.details).join('\n') : 'No audit records.'; }); window.addEventListener('load', ()=>{ refreshBankSelector(); b.renderAll(); }); })();</script></body></html>
